<div id="tour">
  <p>Explore Tours</p>
  <hr>
  <div id="tour-details">
      <div>
          <table>
              <thead>
                  <tr>
                      <th>Name</th>
                      <th>Description</th>
                      <th>Price</th>
                      <th>Tags</th>
                      <th>Starting Key Point</th> <!-- New column for the first key point -->
                      <th>Duration</th> <!-- New column for duration -->
                      <th>Distance</th> <!-- New column for distance -->
                      <th>Reviews</th>
                      <th>Status / Action</th> <!-- Merged column for status and actions -->
                  </tr>
              </thead>
              <tbody>
                  <tr *ngFor="let t of tours">
                      <td>{{ t.name }}</td>
                      <td>{{ t.description }}</td>
                      <td>{{ t.price | currency }}</td>
                      <td>{{ t.tags }}</td>
                      <td>
                          <!-- Check if there is at least one key point and display properties on separate lines -->
                          <div *ngIf="t.keyPoints && t.keyPoints.length > 0; else noKeyPoint">
                              <!-- Name of the first key point -->
                              <div>{{ t.keyPoints[0].name }}</div>
                              
                              <!-- Image of the first key point -->
                              <div>
                                  <img [src]="t.keyPoints[0].imagePath" alt="{{ t.keyPoints[0].name }}" width="80" height="auto" style="margin-top: 5px;">
                              </div>
                              
                              <!-- Description of the first key point -->
                              <div>{{ t.keyPoints[0].description }}</div>
                          </div>
                          
                          <!-- Fallback for when there are no key points -->
                          <ng-template #noKeyPoint>
                              <div>N/A</div>
                          </ng-template>
                      </td>

                      <!-- Duration Column -->
                      <td>
                          <ng-container *ngIf="t.transportInfo; else noTransportInfo">
                              {{ t.transportInfo.time }} minutes
                          </ng-container>
                          <ng-template #noTransportInfo>
                              <div>N/A</div>
                          </ng-template>
                      </td>

                      <!-- Distance Column -->
                      <td>
                          <ng-container *ngIf="t.transportInfo; else noTransportInfoDistance">
                              {{ t.transportInfo.distance }} km
                          </ng-container>
                          <ng-template #noTransportInfoDistance>
                              <div>N/A</div>
                          </ng-template>
                      </td>
                      <td>
                        <button (click)="showReviews(t.id ?? 0)">
                            Show Reviews
                        </button>
                      </td>

                      <!-- Merged Status / Action Column -->
                      <td>
                          <ng-container *ngIf="isPurchased(t.id ?? 0); else notPurchased">
                              <span style="color: green; font-weight: bold;">Purchased</span>
                          </ng-container>
                          <ng-template #notPurchased>
                              <ng-container *ngIf="isTourInCart(t.id ?? 0); else addToCartButton">
                                  <span style="color: blue; font-weight: bold;">In Cart</span>
                              </ng-container>
                              <ng-template #addToCartButton>
                                  <button (click)="addToCart(t.id ?? 0, t.name, t.price)">
                                      Add <img src="assets/icons/cart.png" alt="Shopping Cart" width="20" height="20" style="vertical-align: middle;">
                                  </button>
                              </ng-template>
                          </ng-template>
                      </td>

                  </tr>
              </tbody>
          </table>
      </div>
  </div>


  <!-- Reviews Modal -->
  <div class="modal-overlay" *ngIf="isReviewsModalOpen">
    <div class="modal-content">
        <h2>Reviews</h2>
        
        <div *ngFor="let review of selectedTourReviews" class="review-card">
            <div class="card-header">
                <h3>{{ review.username }}</h3>
                <span class="rating">{{ review.grade }} / 5</span>
            </div>
            <div class="card-content">
                <p style="color: black;"><strong>{{ review.comment }}</strong></p>

                <div class="image-gallery" *ngIf="review.images">
                    <ng-container *ngFor="let image of review.images.split(',')">
                        <img [src]="image.trim()" alt="Review Image" class="review-image">
                    </ng-container>
                </div>
                <p *ngIf="!review.images" class="no-images">No images</p>
            </div>
        </div>

        <div class="pagination-controls">
            <button (click)="goToPreviousPage()" [disabled]="currentPage === 1">Previous</button>
            <span>Page {{ currentPage }} of {{ totalPages }}</span>
            <button (click)="goToNextPage()" [disabled]="currentPage === totalPages">Next</button>
          </div>

        <button (click)="closeReviewsModal()" class="close-button">Close</button>
    </div>
</div>


