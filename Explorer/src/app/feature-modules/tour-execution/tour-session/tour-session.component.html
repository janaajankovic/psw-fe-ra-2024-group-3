<div id="tour" class="tour-container" style="height: max-content;padding-bottom: 20px;">
    <!-- Leva kolona: Ključne tačke -->
    <div class="card-container">
        <div class="buttons">
            <button class="abandon-tour-button" (click)="abandonTour()">Leave the tour</button>
            <button class="report-tour-button" (click)="reportProblem()">Report Problem</button>
        </div>
        <h3>Existing Key Points</h3>
        <div class="card-wrapper">
            <div class="card" *ngFor="let keyPoint of sortedPoints" (click)="onKeyPointSelected(keyPoint)"
                [ngClass]="{ 'completed-card': keyPoint.id && isKeyPointCompleted(keyPoint.id) }">
                <img *ngIf="keyPoint.imagePath" [src]="keyPoint.imagePath" alt="{{ keyPoint.name }}"
                    class="card-image" />
                <div class="card-content">
                    <h4>{{ keyPoint.name }}</h4>
                    <p *ngIf="keyPoint.id && isKeyPointCompleted(keyPoint.id)">
                        <strong>Description:</strong> {{ keyPoint.description }}
                    </p>
                    <p><strong>Latitude:</strong> {{ keyPoint.latitude }}</p>
                    <p><strong>Longitude:</strong> {{ keyPoint.longitude }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Desna kolona: Mapa -->
    <div style="margin-top: 10px;">
        <div class="map-container">
            <xp-tourist-location [keyPoints]="keyPoints" [showEncounters]="true"
                (locationSelected)="onLocationReceived($event)">
            </xp-tourist-location>
        </div>

        <div class="encounters-container">
            <h3>Encounters for current key point</h3>
            <div class="tabs">
                <button class="primary-button" (click)="selectedTab = 'all'"
                    [ngClass]="{ 'active-tab': selectedTab === 'all' }">All
                    Encounters</button>
                <button class="primary-button" (click)="selectedTab = 'required'"
                    [ngClass]="{ 'active-tab': selectedTab === 'required' }">Required
                    Encounters</button>
                <button class="primary-button" (click)="selectedTab = 'completed'"
                    [ngClass]="{ 'active-tab': selectedTab === 'completed' }">Completed Encounters</button>
            </div>
            <div class="encounters-list encounter-wrapper" *ngIf="selectedTab=='all'">
                <ng-container>
                    <div class="encounter-card" *ngFor="let encounter of encounters"
                        [ngClass]="{ 'required-encounter': encounter.creator==0, 'completed-encounter': encounter.isCompletedByMe }">
                        <div style="min-width: 40%;">
                            <p><strong>Name:</strong> {{ encounter.name }}</p>
                            <p><strong>Description:</strong> {{ encounter.description }}</p>
                            <p><strong>Category:</strong>
                                <strong style="color: green;" *ngIf="encounter.type==0"> Social</strong>
                                <strong style="color: green;" *ngIf="encounter.type==1"> Location</strong>
                                <strong style="color: green;" *ngIf="encounter.type==3"> Misc</strong>
                            </p>
                            <p><strong>XP:</strong> {{ encounter.xp }} XP</p>
                            <p *ngIf="encounter.type === 0"><strong>Range:</strong> {{
                                encounter.range }}m</p>
                            <p *ngIf="encounter.type === 0"><strong>Tourists Required:</strong> {{
                                encounter.touristNumber }}</p>
                            <button *ngIf="encounter.type === 1" mat-button
                                style="background-color: #ff7b00;color: white;"
                                (click)="activateEncounter(encounter)">Activate
                                Encounter</button>
                        </div>
                        <td *ngIf="encounter.type === 1">
                            <img *ngIf="encounter.image" [src]="encounter.image" alt="{{ encounter.image }}"
                                class="object-image" />
                            <img *ngIf="!encounter.image" [src]="encounter.image" alt="The image does not exist."
                                class="object-image" />
                        </td>
                    </div>
                </ng-container>
            </div>
            <div class="encounters-list encounter-wrapper" *ngIf="selectedTab=='required'">
                <ng-container>
                    <div class="encounter-card" *ngFor="let encounter of required"
                        [ngClass]="{ 'required-encounter': encounter.creator==0, 'completed-encounter': encounter.isCompletedByMe }">
                        <div style="min-width: 40%;">
                            <p><strong>Name:</strong> {{ encounter.name }}</p>
                            <p><strong>Description:</strong> {{ encounter.description }}</p>
                            <p><strong>Category:</strong>
                                <strong style="color: green;" *ngIf="encounter.type==0"> Social</strong>
                                <strong style="color: green;" *ngIf="encounter.type==1"> Location</strong>
                                <strong style="color: green;" *ngIf="encounter.type==3"> Misc</strong>
                            </p>
                            <p><strong>XP:</strong> {{ encounter.xp }} XP</p>
                            <p *ngIf="encounter.type === 0"><strong>Range:</strong> {{
                                encounter.range }}m</p>
                            <p *ngIf="encounter.type === 0"><strong>Tourists Required:</strong> {{
                                encounter.touristNumber }}</p>
                            <button *ngIf="encounter.type === 1" mat-button
                                style="background-color: #ff7b00;color: white;"
                                (click)="activateEncounter(encounter)">Activate
                                Encounter</button>
                        </div>
                        <td *ngIf="encounter.type === 1">
                            <img *ngIf="encounter.image" [src]="encounter.image" alt="{{ encounter.image }}"
                                class="object-image" />
                            <img *ngIf="!encounter.image" [src]="encounter.image" alt="The image does not exist."
                                class="object-image" />
                        </td>
                    </div>
                </ng-container>
            </div>
            <div class="encounters-list encounter-wrapper" *ngIf="selectedTab=='completed'">
                <ng-container>
                    <div class="encounter-card" *ngFor="let encounter of completed"
                        [ngClass]="{ 'required-encounter': encounter.creator==0, 'completed-encounter': encounter.isCompletedByMe }">
                        <div style="min-width: 40%;">
                            <p><strong>Name:</strong> {{ encounter.name }}</p>
                            <p><strong>Description:</strong> {{ encounter.description }}</p>
                            <p><strong>Category:</strong>
                                <strong style="color: green;" *ngIf="encounter.type==0"> Social</strong>
                                <strong style="color: green;" *ngIf="encounter.type==1"> Location</strong>
                                <strong style="color: green;" *ngIf="encounter.type==3"> Misc</strong>
                            </p>
                            <p><strong>XP:</strong> {{ encounter.xp }} XP</p>
                            <p *ngIf="encounter.type === 0"><strong>Range:</strong> {{
                                encounter.range }}m</p>
                            <p *ngIf="encounter.type === 0"><strong>Tourists Required:</strong> {{
                                encounter.touristNumber }}</p>
                            <button *ngIf="encounter.type === 1" mat-button
                                style="background-color: #ff7b00;color: white;"
                                (click)="activateEncounter(encounter)">Activate
                                Encounter</button>
                        </div>
                        <td *ngIf="encounter.type === 1">
                            <img *ngIf="encounter.image" [src]="encounter.image" alt="{{ encounter.image }}"
                                class="object-image" />
                            <img *ngIf="!encounter.image" [src]="encounter.image" alt="The image does not exist."
                                class="object-image" />
                        </td>
                    </div>
                </ng-container>
            </div>
        </div>
    </div>